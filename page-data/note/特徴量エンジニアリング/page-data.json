{"componentChunkName":"component---src-templates-markdown-post-js","path":"/note/特徴量エンジニアリング/","result":{"data":{"markdownRemark":{"html":"<p>前回の記事では、netkeibaから取得したレース情報をスクレイピングし、Pandasを使ってデータ整形を行いました。今回は、整形されたデータをもとに競馬予想システムの構築に進みます。</p>\n<p>競馬予想には、豊富な特徴量が必要です。レースの距離やコース状況、過去の成績など、さまざまな要素が組み合わさって予想の精度が向上します。ここでは、特徴量エンジニアリングとモデル構築について解説します。</p>\n<p>まずは、特徴量エンジニアリングから始めましょう。以下のコードでは、先ほど整形したデータをもとに特徴量を生成しています。</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token comment\"># 特徴量エンジニアリング</span>\ndf<span class=\"token punctuation\">[</span><span class=\"token string\">\"race_distance\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> df<span class=\"token punctuation\">[</span><span class=\"token string\">\"race_name\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">apply</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">lambda</span> x<span class=\"token punctuation\">:</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">\"m\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\ndf<span class=\"token punctuation\">[</span><span class=\"token string\">\"race_course\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> df<span class=\"token punctuation\">[</span><span class=\"token string\">\"race_name\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">apply</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">lambda</span> x<span class=\"token punctuation\">:</span> x<span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">\" \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># データの表示</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>df<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>上記のコードでは、<code class=\"language-text\">race_name</code>からレースの距離を抽出して<code class=\"language-text\">race_distance</code>列を作成し、レースのコースを抽出して<code class=\"language-text\">race_course</code>列を作成しています。これにより、距離やコースといった重要な情報が特徴量として追加されました。</p>\n<p>次に、LightGBMを使ってモデルの構築を行います。LightGBMは勾配ブースティング法に基づく機械学習モデルであり、競馬予想において高い精度を示すことが知られています。</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">import</span> lightgbm <span class=\"token keyword\">as</span> lgb\n<span class=\"token keyword\">from</span> sklearn<span class=\"token punctuation\">.</span>model_selection <span class=\"token keyword\">import</span> train_test_split\n<span class=\"token keyword\">from</span> sklearn<span class=\"token punctuation\">.</span>metrics <span class=\"token keyword\">import</span> accuracy_score\n\n<span class=\"token comment\"># 特徴量と目的変数の設定</span>\nX <span class=\"token operator\">=</span> df<span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"race_distance\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"race_course\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\ny <span class=\"token operator\">=</span> df<span class=\"token punctuation\">[</span><span class=\"token string\">\"target_variable\"</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token comment\"># 訓練データとテストデータに分割</span>\nX_train<span class=\"token punctuation\">,</span> X_test<span class=\"token punctuation\">,</span> y_train<span class=\"token punctuation\">,</span> y_test <span class=\"token operator\">=</span> train_test_split<span class=\"token punctuation\">(</span>X<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> test_size<span class=\"token operator\">=</span><span class=\"token number\">0.2</span><span class=\"token punctuation\">,</span> random_state<span class=\"token operator\">=</span><span class=\"token number\">42</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># LightGBMモデルの構築と学習</span>\nmodel <span class=\"token operator\">=</span> lgb<span class=\"token punctuation\">.</span>LGBMClassifier<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nmodel<span class=\"token punctuation\">.</span>fit<span class=\"token punctuation\">(</span>X_train<span class=\"token punctuation\">,</span> y_train<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># テストデータでの予測</span>\ny_pred <span class=\"token operator\">=</span> model<span class=\"token punctuation\">.</span>predict<span class=\"token punctuation\">(</span>X_test<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 精度の評価</span>\naccuracy <span class=\"token operator\">=</span> accuracy_score<span class=\"token punctuation\">(</span>y_test<span class=\"token punctuation\">,</span> y_pred<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Accuracy:\"</span><span class=\"token punctuation\">,</span> accuracy<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>上記のコードでは、<code class=\"language-text\">race_distance</code>と<code class=\"language-text\">race_course</code>を特徴量として抽出し、目的変数である<code class=\"language-text\">target_variable</code>としていることを前提にモデルを構築しています。<code class=\"language-text\">train_test_split</code>関数を使用してデータを訓練データとテストデータに分割し、<code class=\"language-text\">LGBMClassifier</code>を用いてLightGBMモデルを構築しています。</p>\n<p>そして、訓練データを用いてモデルを学習させ、テストデータでの予測を行いました。最後に、予測結果の精度を評価するために<code class=\"language-text\">accuracy_score</code>関数を使用し、正解率（Accuracy）を表示しています。</p>\n<p>このように、特徴量エンジニアリングとモデル構築を組み合わせることで、競馬予想システムを構築する基本的な手順が完了しました。次回の記事では、モデルの評価やパラメータチューニングについて詳しく解説します。</p>","frontmatter":{"title":"特徴量エンジニアリング"}}},"pageContext":{"id":"c21a2329-b760-5e39-a685-343a2cb17de9"}},"staticQueryHashes":["1251307220","772138545"],"slicesMap":{}}