{"componentChunkName":"component---src-templates-markdown-post-js","path":"/note/5.予測結果の解析/","result":{"data":{"markdownRemark":{"html":"<p>前回の記事では、モデルの評価とパラメータチューニングの手順を解説しました。今回は、実際のレースデータを用いて予測を行い、予測結果の解析と改善方法の考察を行っていきましょう。</p>\n<p>予測結果の解析を行うために、まずは新たなデータセットを用意します。netkeibaから取得したレース情報のうち、最新のデータを取得してください。データの整形は前回の記事で行った方法と同様に行ってください。</p>\n<p>次に、モデルを使って予測を行います。以下のコードでは、新たなデータセットを使って予測を行い、予測結果を評価しています。</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token comment\"># 新たなデータセットの読み込みと整形</span>\nnew_df <span class=\"token operator\">=</span> pd<span class=\"token punctuation\">.</span>read_csv<span class=\"token punctuation\">(</span><span class=\"token string\">\"new_data.csv\"</span><span class=\"token punctuation\">)</span>\nnew_df<span class=\"token punctuation\">[</span><span class=\"token string\">\"race_distance\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> new_df<span class=\"token punctuation\">[</span><span class=\"token string\">\"race_name\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">apply</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">lambda</span> x<span class=\"token punctuation\">:</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">\"m\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\nnew_df<span class=\"token punctuation\">[</span><span class=\"token string\">\"race_course\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> new_df<span class=\"token punctuation\">[</span><span class=\"token string\">\"race_name\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">apply</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">lambda</span> x<span class=\"token punctuation\">:</span> x<span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">\" \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 特徴量の抽出</span>\nX_new <span class=\"token operator\">=</span> new_df<span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"race_distance\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"race_course\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token comment\"># 予測結果の取得</span>\ny_pred_new <span class=\"token operator\">=</span> model<span class=\"token punctuation\">.</span>predict<span class=\"token punctuation\">(</span>X_new<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 予測結果の解析</span>\npredicted_probabilities <span class=\"token operator\">=</span> model<span class=\"token punctuation\">.</span>predict_proba<span class=\"token punctuation\">(</span>X_new<span class=\"token punctuation\">)</span>\nclass_probabilities <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>prob<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">for</span> prob <span class=\"token keyword\">in</span> predicted_probabilities<span class=\"token punctuation\">]</span>\n\n<span class=\"token comment\"># 予測結果と確率の表示</span>\nnew_df<span class=\"token punctuation\">[</span><span class=\"token string\">\"predicted_result\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> y_pred_new\nnew_df<span class=\"token punctuation\">[</span><span class=\"token string\">\"class_probability\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> class_probabilities\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>new_df<span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"race_name\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"predicted_result\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"class_probability\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>上記のコードでは、新たなデータセットを読み込み、特徴量を抽出しています。そして、<code class=\"language-text\">predict</code>メソッドを使って予測結果を取得し、<code class=\"language-text\">predict_proba</code>メソッドを使って各クラスの確率を取得しています。</p>\n<p>最後に、予測結果と確率を表示しています。これにより、各レースの予測結果とその確信度を確認することができます。予測結果と実際のレース結果を比較し、モデルの性能を評価することが重要です。</p>\n<p>予測結果の解析に基づいて、モデルの改善方法を考察しましょう。予測が外れたケースや確信度が低い場合には、以下のような改善点が考えられます。</p>","frontmatter":{"title":"5.予測結果の解析","date":"2023/05/20","slug":"predict"}}},"pageContext":{"id":"0263097d-8b42-51a7-8e20-736e7a7c9498"}},"staticQueryHashes":["772138545"],"slicesMap":{}}