{"componentChunkName":"component---src-templates-markdown-post-js","path":"/note/01_予測/1.スクレイピングとデータ整形/","result":{"data":{"markdownRemark":{"html":"<p>PythonのPandasを使って競馬のデータ整形を行う方法についてご紹介します。</p>\n<p>競馬予想には、豊富なデータが必要ですが、そのデータを手作業で入力するのは非効率ですよね。\nそこで、有名な競馬情報サイトである<a href=\"https://www.netkeiba.com/\">netkeiba</a>からデータをスクレイピングし、\nPythonのPandasを使って整形する方法を解説します。</p>\n<p>まず、スクレイピングにはPythonのライブラリであるBeautifulSoupを使用します。\nBeautifulSoupを使って、netkeibaのサイトからレース情報を取得しましょう。</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">import</span> requests\n<span class=\"token keyword\">from</span> bs4 <span class=\"token keyword\">import</span> BeautifulSoup\n\n<span class=\"token comment\"># レース情報のURL</span>\nurl <span class=\"token operator\">=</span> <span class=\"token string\">\"https://www.netkeiba.com/\"</span>\n\n<span class=\"token comment\"># ページの取得</span>\nresponse <span class=\"token operator\">=</span> requests<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span>\nhtml <span class=\"token operator\">=</span> response<span class=\"token punctuation\">.</span>content\n\n<span class=\"token comment\"># BeautifulSoupを使ってHTMLをパース</span>\nsoup <span class=\"token operator\">=</span> BeautifulSoup<span class=\"token punctuation\">(</span>html<span class=\"token punctuation\">,</span> <span class=\"token string\">\"html.parser\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># レース情報の要素を取得</span>\nrace_info <span class=\"token operator\">=</span> soup<span class=\"token punctuation\">.</span>find_all<span class=\"token punctuation\">(</span><span class=\"token string\">\"div\"</span><span class=\"token punctuation\">,</span> class_<span class=\"token operator\">=</span><span class=\"token string\">\"race-info\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># レース情報の整形と表示</span>\n<span class=\"token keyword\">for</span> info <span class=\"token keyword\">in</span> race_info<span class=\"token punctuation\">:</span>\n    race_name <span class=\"token operator\">=</span> info<span class=\"token punctuation\">.</span>find<span class=\"token punctuation\">(</span><span class=\"token string\">\"span\"</span><span class=\"token punctuation\">,</span> class_<span class=\"token operator\">=</span><span class=\"token string\">\"race_name\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>text\n    race_date <span class=\"token operator\">=</span> info<span class=\"token punctuation\">.</span>find<span class=\"token punctuation\">(</span><span class=\"token string\">\"span\"</span><span class=\"token punctuation\">,</span> class_<span class=\"token operator\">=</span><span class=\"token string\">\"date\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>text\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>race_name<span class=\"token punctuation\">,</span> race_date<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>上記のコードでは、<code class=\"language-text\">requests</code>ライブラリを使ってnetkeibaのサイトにアクセスし、<code class=\"language-text\">BeautifulSoup</code>でHTMLをパースしています。<code class=\"language-text\">race_info</code>という変数には、レース情報が含まれています。</p>\n<p>次に、取得したデータをPandasを使って整形します。Pandasはデータ解析や操作に優れたライブラリであり、競馬のデータ整形にも便利です。</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">import</span> pandas <span class=\"token keyword\">as</span> pd\n\n<span class=\"token comment\"># 取得したデータを辞書型に格納</span>\ndata <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"race_name\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"race_date\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\"># データの整形</span>\n<span class=\"token keyword\">for</span> info <span class=\"token keyword\">in</span> race_info<span class=\"token punctuation\">:</span>\n    race_name <span class=\"token operator\">=</span> info<span class=\"token punctuation\">.</span>find<span class=\"token punctuation\">(</span><span class=\"token string\">\"span\"</span><span class=\"token punctuation\">,</span> class_<span class=\"token operator\">=</span><span class=\"token string\">\"race_name\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>text\n    race_date <span class=\"token operator\">=</span> info<span class=\"token punctuation\">.</span>find<span class=\"token punctuation\">(</span><span class=\"token string\">\"span\"</span><span class=\"token punctuation\">,</span> class_<span class=\"token operator\">=</span><span class=\"token string\">\"date\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>text\n    \n    data<span class=\"token punctuation\">[</span><span class=\"token string\">\"race_name\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>race_name<span class=\"token punctuation\">)</span>\n    data<span class=\"token punctuation\">[</span><span class=\"token string\">\"race_date\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>race_date<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># データフレームの作成</span>\ndf <span class=\"token operator\">=</span> pd<span class=\"token punctuation\">.</span>DataFrame<span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># データの表示</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>df<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>上記のコードでは、辞書型を用意し、ループを回してデータを整形しています。最後に、<code class=\"language-text\">pd.DataFrame</code>を使ってデータフレームを作成し、整形したデータを表示しています。</p>\n<p>これで、netkeibaから取得したレース情報を整形することができました。</p>","frontmatter":{"title":"1.スクレイピングとデータ整形","date":"2023/05/01","slug":"predict"}}},"pageContext":{"id":"2efef7d9-5b40-5070-b9ba-72b90d99937c"}},"staticQueryHashes":["772138545"],"slicesMap":{}}